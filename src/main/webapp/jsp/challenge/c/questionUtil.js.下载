define("nowcoder/1.2.1232/javascripts/site/question/questionUtil",["nc","cpn","ncpc","../../action/contest","../../core/siteConfig","ncPlugin/highlighter/highlighter","../../util/littleAction","../../action/note"],function(t,n,e){var i=t("nc"),o=t("cpn"),s=t("ncpc"),l=i.$,a=i.Browser,r=(i.Limit,i.DragDrop),d=i.ShortCut,c=i.Str,u=i.Time,h=i.Db,f=o.Popup,w=(i.Dom,s.Code),g=t("../../action/contest"),m=t("../../core/siteConfig"),v=t("ncPlugin/highlighter/highlighter"),p=t("../../util/littleAction");e.exports={init:function b(t){var n=this;n.lastLeft=0,n.isPause=!1,n.dragEl=l("div.full-separator"),n.topicDv=l("div.nowcoder-topic"),n.topicAnswerDv=l("div.nowcoder-topic-answer"),n.questionInfoIpt=l("#jsQuestionInfo"),n.canPauseTime=!!window.canPauseTime,n.initTestPing(),n.initTime(t.timeContainer,t.timeEl,t.isCountingUp),n.initCollect(),n.initShield(),n.initMark(),0<n.dragEl.length&&n.initDragSplit();v.init(),n.initShortCut(t.timeContainer),l("div.answer-sheet-box a.card-unfold").on("click",n.toggleFold),l("div.answer-sheet-box a.card-fold").on("click",n.toggleFold),l("div.answer-sheet-box")["1"===h.get("hideanswersheetbox")?"removeClass":"addClass"]("open"),l("div.synchronization").on("click",n.toggleSynchronization),"0"===h.get("nkSynchronization")&&(l("div.synchronization").removeClass("selected"),setTimeout(function(){l("#submitForm input[name=sync]").remove()},1e3));n.initClickA(),l(document).on("click","ul.answer-sheet-num a",function(t){t.preventDefault();var n=l(t.currentTarget),e=n.attr("data-qid");window.nQFinish=1,l("#submitForm").append('<input type="hidden" name="nqid" value="'+e+'" />').submit()}),w.onlineJudgeHelp({el:l("a.js-click-help")}),n.initCheat(+window.questionInfo.type),l("a.js-parent-fold").on("click",function(t){var n=l(t.currentTarget),e=n.closest(".js-parent-content"),i="1"===n.attr("data-type");e[i?"addClass":"removeClass"]("open")})},initTime:function C(t,n,e){var i=this,o=+n.data("left")||0,s=+n.data("time")||0,a=e?s:o;i.showTime(n,a,e),i.canPauseTime&&(t=l(t)).on("click",function(){i.toggleTiming(t)})},initCollect:function T(){var t=l(".js-follow");t=0===t.length?l(".js-unfollow"):t,p.follow({followCls:"js-follow",unfollowCls:"js-unfollow",followStr:"收藏本题",entityId:t.attr("data-id"),entityType:m.type.problem})},initClickA:function k(){var i=this;l("a").on("click",function(t){var n=l(t.currentTarget),e=n.attr("href");c.isJsHref(e)||"0"===n.attr("data-prevent")||(t.preventDefault(),window.isLogin?f.confirm("你本次试卷尚未提交，是否确定离开本页？",function(){window.location.href=e}):new f({width:500,title:"提示",hasNoMove:!0,content:['<div class="confirm-content">','<div class="poptip-word">','<span class="warning-ico"></span>','<span class="warning-word">不想继续做题了吗？直接交卷后可以看正确答案哦！</span>',"</div>","</div>"].join(""),okTxt:"提前交卷",cancelTxt:"直接离开",listeners:{ok:function(){i.submitTest()},cancel:function(){window.location.href=e}}}))})},initTestPing:function y(){var t=this,n=window.questionInfo.tid;if(!n)return;var e=!!window.isContest;window.setInterval(function(){t.isPause||(e?g.testContestPing({body:{testId:n}}):g.testPing({body:{testId:n}}))},6e4)},initShortCut:function P(t){var n=this;n.canPauseTime&&d.add("space",function(){n.isPause||n.toggleTiming(t)});function e(t){t.preventDefault();var n=l("ul.answer-sheet-num a.answering-num").closest("li"),e=n.next();if(0!==e.length){var i=e.find("a"),o=i.attr("data-qid");window.nQFinish=1,l("#submitForm").append('<input type="hidden" name="nqid" value="'+o+'" />').submit()}}function i(t){t.preventDefault();var n=l("ul.answer-sheet-num a.answering-num").closest("li"),e=n.prev();if(0!==e.length){var i=e.find("a"),o=i.attr("data-qid");window.nQFinish=1,l("#submitForm").append('<input type="hidden" name="nqid" value="'+o+'" />').submit()}}d.add("up",i),d.add("left",i),d.add("down",e),d.add("right",e)},initShield:function S(){var t=l(".js-shield");t=0===t.length?l(".js-unshield"):t,p.shieldQuestion({shieldCls:"js-shield",unShieldCls:"js-unshield",shieldStr:"屏蔽本题",shieldedStr:"取消屏蔽",entityId:t.attr("data-id")})},initMark:function j(){var t=l(".js-mark");t=0===t.length?l(".js-unmark"):t,p.markQuestion({markCls:"js-mark",unMarkCls:"js-unmark",markStr:"标记一下",markedStr:"已标记",entityId:t.attr("data-id"),testId:t.attr("data-tid"),dtkEls:l("ul.answer-sheet-num a")})},toggleTiming:function D(t){var n=this;n.isPause=!n.isPause,t[n.isPause?"addClass":"removeClass"]("time-pause"),t.attr("title",n.isPause?"继续":"暂停");var e=n.questionInfoIpt,i=e.attr("data-tid");if(!n.isPause)return void g.testRestart({body:{testId:i}});g.testStop({body:{testId:i}}),new f({width:500,title:"提示",hasNoMove:!0,hasNoTitle:!0,content:['<div class="confirm-content">','<div class="poptip-word">','<span class="warning-ico"></span>','<span class="warning-word">休息一下吧！共 '+(e.attr("data-total")||"")+" 道题，还剩 "+(e.attr("data-left")||"")+" 道没做哦~</span>","</div>","</div>"].join(""),okTxt:"继续做题",cancelTxt:"下次再做",ok:function(){this.close(),n.toggleTiming(t)},cancel:function(){window.location.href="/"}})},showTime:function x(t,n,e){var i=this;if(!i.isPause){if(!e&&n<=0)return t.html("答题时间结束"),void i.submitTest();var o=u.second(n);t.html(o),t.css("font-size",8<o.length?"18px":"20px"),n=e?n+1:Math.max(0,n-1)}0<=n&&setTimeout(function(){i.showTime(t,n,e)},1e3)},toggleFold:function I(t){var n=l(t.currentTarget).parent();n.toggleClass("open"),n.hasClass("open")?h.remove("hideanswersheetbox"):h.set("hideanswersheetbox","1")},toggleSynchronization:function q(t){t.preventDefault(),l(t.currentTarget).hasClass("selected")?h.set("nkSynchronization","0"):h.remove("nkSynchronization")},gotoFullScreen:function A(t){var n=this,e=l(document.body),i=l("div.nk-container"),o=l("div.nk-main"),s=l("div.nowcoder-topic"),a=l("div.nowcoder-topic-answer");if(t||t===undefined){h.set("questionFullScreen","1"),e.addClass("full-screen-body nk-body"),i.css("backgroundPositionX","35%"),i.css("backgroundPositionY","0"),o.addClass("full-screen-subject"),s.css("width",n.lastLeft?n.lastLeft:"35%"),n.setDragPos(s.width()+10),n.dragEl.show();var r=l(window).height();s.outerHeight(r),a.outerHeight(r),l(window).on("resize",n._winResizeCb=function(){var t=l(window).height();s.outerHeight(t),a.outerHeight(t),n.dragEl.height(t)})}else h.remove("questionFullScreen"),e.removeClass("full-screen-body nk-body"),o.removeAttr("style"),o.removeClass("full-screen-subject"),s.removeAttr("style"),a.removeAttr("style"),n.dragEl.hide(),s.height("auto"),a.height("auto"),n._winResizeCb&&(l(window).unbind("resize",n._winResizeCb),n._winResizeCb=null)},initDragSplit:function z(){var i=this,t=i.dragEl;new r({drag:t,listeners:[{name:"start",handler:function(){this.offset=t.offset()}},{name:"drag",handler:function(){var t=this,n=t.offset,e=n.left+t._moveX-t._downX;n.top,t._moveY,t._downY;i.setDragPos(e)}},{name:"drop",handler:function(){this.offset=null}}]})},setDragPos:function F(t){var n=this.dragEl,e=this.topicDv,i=this.topicAnswerDv,o=l(window).width();t<300&&(t=300);o-t<450&&(t=o-450);var s=100*(this.lastLeft=t)/o;n.css("marginLeft",s+"%"),n.css("height",l(window).height()),e.css("width",s-.8+"%"),i.css("marginLeft",s+"%"),i.css("width",100-s-2.8+"%")},initCheat:function E(t){var n=this,e=window.questionInfo.tid;if(!window.isContest)return;var i=+window.leaveCount||0;n.forbidRightMenu(),n.forbidSelect();var o=m.questionType;t!==o.danxuan&&t!==o.duoxuan&&t!==o.tiankong||(3<i&&(n.cheatAlerting=!0,f.alert("很遗憾，你离开当前考试页面的次数已经超过 3 次，系统将为你强制交卷，并记录违规行为。",function(){n.cheatAlerting=!1,n.submitTest()})),n.forbidBurWindow(function(){n.cheatAlerting||(g.addLeave({body:{testId:e}}),3<++i?(n.cheatAlerting=!0,f.alert("很遗憾，你离开当前考试页面的次数已经超过 3 次，系统将为你强制交卷，并记录违规行为。",function(){n.cheatAlerting=!1,n.submitTest()})):(n.cheatAlerting=!0,f.alert("你已离开当前页面 "+i+" 次，客观题部分离开超过 3 次将无法继续考试。",function(){n.cheatAlerting=!1})))}))},forbidRightMenu:function L(){l(document).on("contextmenu",function(){return!1}).on("click",function(t){3===t.witch&&t.preventDefault()})},forbidSelect:function M(){l(document).on("selectstart",function(){return!1}),l(document.body).css("-moz-user-select","none")},forbidBurWindow:function _(t,n){var e=null,i=!0,o=a.ie();l(window).blur(function(){o&&o<=8&&i?i=!1:(e&&window.clearTimeout(e),e=window.setTimeout(function(){t&&t()},1e4))}),l(window).focus(function(){e&&window.clearTimeout(e),e=null})},submitTest:function Q(){window.nQFinish=1,l("#submitForm").append('<input type="hidden" name="finish" value="1" />').submit()}}});